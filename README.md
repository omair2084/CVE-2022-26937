# Windows Network File System Crash PoC #
## CVE-2022-26937 ##

```
nt!KeBugCheckEx:
fffff803`8996efa0 48894c2408      mov     qword ptr [rsp+8],rcx ss:0018:ffffd000`d589ae60=0000000000000139
1: kd> !analyze -v
*******************************************************************************
*                                                                             *
*                        Bugcheck Analysis                                    *
*                                                                             *
*******************************************************************************

KERNEL_SECURITY_CHECK_FAILURE (139)
A kernel component has corrupted a critical data structure.  The corruption
could potentially allow a malicious user to gain control of this machine.
Arguments:
Arg1: 0000000000000002, Stack cookie instrumentation code detected a stack-based
	buffer overrun.
Arg2: ffffd000d589b180, Address of the trap frame for the exception that caused the BugCheck
Arg3: ffffd000d589b0d8, Address of the exception record for the exception that caused the BugCheck
Arg4: 0000000000000000, Reserved

Debugging Details:
------------------


KEY_VALUES_STRING: 1

    Key  : Analysis.CPU.mSec
    Value: 1124

    Key  : Analysis.DebugAnalysisManager
    Value: Create

    Key  : Analysis.Elapsed.mSec
    Value: 34762

    Key  : Analysis.Init.CPU.mSec
    Value: 609

    Key  : Analysis.Init.Elapsed.mSec
    Value: 517613

    Key  : Analysis.Memory.CommitPeak.Mb
    Value: 77

    Key  : FailFast.Name
    Value: STACK_COOKIE_CHECK_FAILURE

    Key  : FailFast.Type
    Value: 2

    Key  : WER.OS.Branch
    Value: winblue_gdr

    Key  : WER.OS.Timestamp
    Value: 2014-02-21T19:52:00Z

    Key  : WER.OS.Version
    Value: 8.1.9600.17031


FILE_IN_CAB:  061622-6921-01.dmp

VIRTUAL_MACHINE:  VMware

BUGCHECK_CODE:  139

BUGCHECK_P1: 2

BUGCHECK_P2: ffffd000d589b180

BUGCHECK_P3: ffffd000d589b0d8

BUGCHECK_P4: 0

TRAP_FRAME:  ffffd000d589b180 -- (.trap 0xffffd000d589b180)
NOTE: The trap frame does not contain all registers.
Some register values may be zeroed or incorrect.
rax=00000000c0000001 rbx=0000000000000000 rcx=0000000000000002
rdx=ffffe000515c2010 rsi=0000000000000000 rdi=0000000000000000
rip=fffff80158eeeb05 rsp=ffffd000d589b318 rbp=ffffd000d589b420
 r8=ffffe000515c2010  r9=0000000000000268 r10=ffffe000514df130
r11=ffffe0005188d010 r12=0000000000000000 r13=0000000000000000
r14=0000000000000000 r15=0000000000000000
iopl=0         nv up ei ng nz ac po nc
nfssvr!_report_gsfailure+0x5:
fffff801`58eeeb05 cd29            int     29h
Resetting default scope

EXCEPTION_RECORD:  ffffd000d589b0d8 -- (.exr 0xffffd000d589b0d8)
ExceptionAddress: fffff80158eeeb05 (nfssvr!_report_gsfailure+0x0000000000000005)
   ExceptionCode: c0000409 (Security check failure or stack buffer overrun)
  ExceptionFlags: 00000001
NumberParameters: 1
   Parameter[0]: 0000000000000002
Subcode: 0x2 FAST_FAIL_STACK_COOKIE_CHECK_FAILURE 

CUSTOMER_CRASH_COUNT:  1

PROCESS_NAME:  System

ERROR_CODE: (NTSTATUS) 0xc0000409 - The system detected an overrun of a stack-based buffer in this application. This overrun could potentially allow a malicious user to gain control of this application.

EXCEPTION_CODE_STR:  c0000409

EXCEPTION_PARAMETER1:  0000000000000002

EXCEPTION_STR:  0xc0000409

SYMBOL_NAME:  nfssvr!_report_gsfailure+5

MODULE_NAME: nfssvr

IMAGE_NAME:  nfssvr.sys

IMAGE_VERSION:  6.3.9600.16384

STACK_COMMAND:  .cxr; .ecxr ; kb

BUCKET_ID_FUNC_OFFSET:  5

FAILURE_BUCKET_ID:  0x139_MISSING_GSFRAME_nfssvr!_report_gsfailure

OS_VERSION:  8.1.9600.17031

BUILDLAB_STR:  winblue_gdr

OSPLATFORM_TYPE:  x64

OSNAME:  Windows 8.1

FAILURE_ID_HASH:  {998b6b82-b64e-49ce-d962-6836c54aa899}

Followup:     MachineOwner
---------

1: kd> k
 # Child-SP          RetAddr               Call Site
00 ffffd000`d589ae58 fffff803`8997aae9     nt!KeBugCheckEx
01 ffffd000`d589ae60 fffff803`8997ae10     nt!KiBugCheckDispatch+0x69
02 ffffd000`d589afa0 fffff803`8997a034     nt!KiFastFailDispatch+0xd0
03 ffffd000`d589b180 fffff801`58eeeb05     nt!KiRaiseSecurityCheckFailure+0xf4
04 ffffd000`d589b318 fffff801`58ec8282     nfssvr!_report_gsfailure+0x5
05 ffffd000`d589b320 41414141`41414141     nfssvr!NlmGetClientAddressAndConnection+0xd7e
06 ffffd000`d589b4b0 41414141`41414141     0x41414141`41414141
07 ffffd000`d589b4b8 41414141`41414141     0x41414141`41414141
08 ffffd000`d589b4c0 41414141`41414141     0x41414141`41414141
09 ffffd000`d589b4c8 41414141`41414141     0x41414141`41414141
0a ffffd000`d589b4d0 41414141`41414141     0x41414141`41414141
0b ffffd000`d589b4d8 41414141`41414141     0x41414141`41414141
0c ffffd000`d589b4e0 41414141`41414141     0x41414141`41414141
0d ffffd000`d589b4e8 41414141`41414141     0x41414141`41414141
0e ffffd000`d589b4f0 41414141`41414141     0x41414141`41414141
0f ffffd000`d589b4f8 41414141`41414141     0x41414141`41414141
10 ffffd000`d589b500 41414141`41414141     0x41414141`41414141
11 ffffd000`d589b508 41414141`41414141     0x41414141`41414141
12 ffffd000`d589b510 41414141`41414141     0x41414141`41414141
13 ffffd000`d589b518 41414141`41414141     0x41414141`41414141
14 ffffd000`d589b520 41414141`41414141     0x41414141`41414141
15 ffffd000`d589b528 41414141`41414141     0x41414141`41414141
16 ffffd000`d589b530 41414141`41414141     0x41414141`41414141
17 ffffd000`d589b538 41414141`41414141     0x41414141`41414141
18 ffffd000`d589b540 41414141`41414141     0x41414141`41414141
19 ffffd000`d589b548 41414141`41414141     0x41414141`41414141
1a ffffd000`d589b550 41414141`41414141     0x41414141`41414141
1b ffffd000`d589b558 41414141`41414141     0x41414141`41414141
1c ffffd000`d589b560 41414141`41414141     0x41414141`41414141
1d ffffd000`d589b568 41414141`41414141     0x41414141`41414141
1e ffffd000`d589b570 41414141`41414141     0x41414141`41414141
1f ffffd000`d589b578 41414141`41414141     0x41414141`41414141
20 ffffd000`d589b580 41414141`41414141     0x41414141`41414141
21 ffffd000`d589b588 41414141`41414141     0x41414141`41414141
22 ffffd000`d589b590 41414141`41414141     0x41414141`41414141
23 ffffd000`d589b598 41414141`41414141     0x41414141`41414141
24 ffffd000`d589b5a0 41414141`41414141     0x41414141`41414141
25 ffffd000`d589b5a8 41414141`41414141     0x41414141`41414141
26 ffffd000`d589b5b0 41414141`41414141     0x41414141`41414141
27 ffffd000`d589b5b8 41414141`41414141     0x41414141`41414141
28 ffffd000`d589b5c0 41414141`41414141     0x41414141`41414141
29 ffffd000`d589b5c8 41414141`41414141     0x41414141`41414141
2a ffffd000`d589b5d0 41414141`41414141     0x41414141`41414141
2b ffffd000`d589b5d8 41414141`41414141     0x41414141`41414141
2c ffffd000`d589b5e0 41414141`41414141     0x41414141`41414141
2d ffffd000`d589b5e8 41414141`41414141     0x41414141`41414141
2e ffffd000`d589b5f0 41414141`41414141     0x41414141`41414141
2f ffffd000`d589b5f8 41414141`41414141     0x41414141`41414141
30 ffffd000`d589b600 41414141`41414141     0x41414141`41414141
31 ffffd000`d589b608 41414141`41414141     0x41414141`41414141
32 ffffd000`d589b610 41414141`41414141     0x41414141`41414141
33 ffffd000`d589b618 41414141`41414141     0x41414141`41414141
34 ffffd000`d589b620 41414141`41414141     0x41414141`41414141
35 ffffd000`d589b628 41414141`41414141     0x41414141`41414141
36 ffffd000`d589b630 41414141`41414141     0x41414141`41414141
37 ffffd000`d589b638 41414141`41414141     0x41414141`41414141
38 ffffd000`d589b640 41414141`41414141     0x41414141`41414141
39 ffffd000`d589b648 41414141`41414141     0x41414141`41414141
3a ffffd000`d589b650 41414141`41414141     0x41414141`41414141
3b ffffd000`d589b658 41414141`41414141     0x41414141`41414141
3c ffffd000`d589b660 41414141`41414141     0x41414141`41414141
3d ffffd000`d589b668 41414141`41414141     0x41414141`41414141
3e ffffd000`d589b670 41414141`41414141     0x41414141`41414141
3f ffffd000`d589b678 41414141`41414141     0x41414141`41414141
40 ffffd000`d589b680 41414141`41414141     0x41414141`41414141
41 ffffd000`d589b688 41414141`41414141     0x41414141`41414141
42 ffffd000`d589b690 41414141`41414141     0x41414141`41414141
43 ffffd000`d589b698 41414141`41414141     0x41414141`41414141
44 ffffd000`d589b6a0 41414141`41414141     0x41414141`41414141
45 ffffd000`d589b6a8 41414141`41414141     0x41414141`41414141
46 ffffd000`d589b6b0 41414141`41414141     0x41414141`41414141
47 ffffd000`d589b6b8 41414141`41414141     0x41414141`41414141
48 ffffd000`d589b6c0 41414141`41414141     0x41414141`41414141
49 ffffd000`d589b6c8 41414141`41414141     0x41414141`41414141
4a ffffd000`d589b6d0 41414141`41414141     0x41414141`41414141
4b ffffd000`d589b6d8 41414141`41414141     0x41414141`41414141
4c ffffd000`d589b6e0 41414141`41414141     0x41414141`41414141
4d ffffd000`d589b6e8 41414141`41414141     0x41414141`41414141
4e ffffd000`d589b6f0 41414141`41414141     0x41414141`41414141
4f ffffd000`d589b6f8 41414141`41414141     0x41414141`41414141
50 ffffd000`d589b700 41414141`41414141     0x41414141`41414141
51 ffffd000`d589b708 41414141`41414141     0x41414141`41414141
52 ffffd000`d589b710 41414141`41414141     0x41414141`41414141
53 ffffd000`d589b718 41414141`41414141     0x41414141`41414141
54 ffffd000`d589b720 41414141`41414141     0x41414141`41414141
55 ffffd000`d589b728 41414141`41414141     0x41414141`41414141
56 ffffd000`d589b730 41414141`41414141     0x41414141`41414141
57 ffffd000`d589b738 41414141`41414141     0x41414141`41414141
58 ffffd000`d589b740 41414141`41414141     0x41414141`41414141
59 ffffd000`d589b748 41414141`41414141     0x41414141`41414141
5a ffffd000`d589b750 41414141`41414141     0x41414141`41414141
5b ffffd000`d589b758 41414141`41414141     0x41414141`41414141
5c ffffd000`d589b760 41414141`41414141     0x41414141`41414141
5d ffffd000`d589b768 41414141`41414141     0x41414141`41414141
5e ffffd000`d589b770 41414141`41414141     0x41414141`41414141
5f ffffd000`d589b778 41414141`41414141     0x41414141`41414141
60 ffffd000`d589b780 41414141`41414141     0x41414141`41414141
61 ffffd000`d589b788 41414141`41414141     0x41414141`41414141
62 ffffd000`d589b790 41414141`41414141     0x41414141`41414141
63 ffffd000`d589b798 41414141`41414141     0x41414141`41414141
64 ffffd000`d589b7a0 41414141`41414141     0x41414141`41414141
65 ffffd000`d589b7a8 41414141`41414141     0x41414141`41414141
66 ffffd000`d589b7b0 41414141`41414141     0x41414141`41414141
67 ffffd000`d589b7b8 41414141`41414141     0x41414141`41414141
68 ffffd000`d589b7c0 41414141`41414141     0x41414141`41414141
69 ffffd000`d589b7c8 41414141`41414141     0x41414141`41414141
6a ffffd000`d589b7d0 41414141`41414141     0x41414141`41414141
6b ffffd000`d589b7d8 41414141`41414141     0x41414141`41414141
6c ffffd000`d589b7e0 41414141`41414141     0x41414141`41414141
6d ffffd000`d589b7e8 41414141`41414141     0x41414141`41414141
6e ffffd000`d589b7f0 41414141`41414141     0x41414141`41414141
6f ffffd000`d589b7f8 41414141`41414141     0x41414141`41414141
70 ffffd000`d589b800 41414141`41414141     0x41414141`41414141
71 ffffd000`d589b808 41414141`41414141     0x41414141`41414141
72 ffffd000`d589b810 41414141`41414141     0x41414141`41414141
73 ffffd000`d589b818 41414141`41414141     0x41414141`41414141
74 ffffd000`d589b820 41414141`41414141     0x41414141`41414141
75 ffffd000`d589b828 41414141`41414141     0x41414141`41414141
76 ffffd000`d589b830 41414141`41414141     0x41414141`41414141
77 ffffd000`d589b838 41414141`41414141     0x41414141`41414141
78 ffffd000`d589b840 41414141`41414141     0x41414141`41414141
79 ffffd000`d589b848 41414141`41414141     0x41414141`41414141
7a ffffd000`d589b850 41414141`41414141     0x41414141`41414141
7b ffffd000`d589b858 41414141`41414141     0x41414141`41414141
7c ffffd000`d589b860 41414141`41414141     0x41414141`41414141
7d ffffd000`d589b868 41414141`41414141     0x41414141`41414141
7e ffffd000`d589b870 41414141`41414141     0x41414141`41414141
7f ffffd000`d589b878 41414141`41414141     0x41414141`41414141
80 ffffd000`d589b880 41414141`41414141     0x41414141`41414141
81 ffffd000`d589b888 41414141`41414141     0x41414141`41414141
82 ffffd000`d589b890 41414141`41414141     0x41414141`41414141
83 ffffd000`d589b898 41414141`41414141     0x41414141`41414141
84 ffffd000`d589b8a0 41414141`41414141     0x41414141`41414141
85 ffffd000`d589b8a8 41414141`41414141     0x41414141`41414141
86 ffffd000`d589b8b0 41414141`41414141     0x41414141`41414141
87 ffffd000`d589b8b8 41414141`41414141     0x41414141`41414141
88 ffffd000`d589b8c0 41414141`41414141     0x41414141`41414141
89 ffffd000`d589b8c8 41414141`41414141     0x41414141`41414141
8a ffffd000`d589b8d0 41414141`41414141     0x41414141`41414141
8b ffffd000`d589b8d8 41414141`41414141     0x41414141`41414141
8c ffffd000`d589b8e0 41414141`41414141     0x41414141`41414141
8d ffffd000`d589b8e8 41414141`41414141     0x41414141`41414141
8e ffffd000`d589b8f0 41414141`41414141     0x41414141`41414141
8f ffffd000`d589b8f8 41414141`41414141     0x41414141`41414141
90 ffffd000`d589b900 41414141`41414141     0x41414141`41414141
91 ffffd000`d589b908 41414141`41414141     0x41414141`41414141
92 ffffd000`d589b910 41414141`41414141     0x41414141`41414141
93 ffffd000`d589b918 41414141`41414141     0x41414141`41414141
94 ffffd000`d589b920 41414141`41414141     0x41414141`41414141
95 ffffd000`d589b928 41414141`41414141     0x41414141`41414141
96 ffffd000`d589b930 41414141`41414141     0x41414141`41414141
97 ffffd000`d589b938 41414141`41414141     0x41414141`41414141
98 ffffd000`d589b940 41414141`41414141     0x41414141`41414141
99 ffffd000`d589b948 41414141`41414141     0x41414141`41414141
9a ffffd000`d589b950 41414141`41414141     0x41414141`41414141
9b ffffd000`d589b958 41414141`41414141     0x41414141`41414141
9c ffffd000`d589b960 41414141`41414141     0x41414141`41414141
9d ffffd000`d589b968 41414141`41414141     0x41414141`41414141
9e ffffd000`d589b970 41414141`41414141     0x41414141`41414141
9f ffffd000`d589b978 41414141`41414141     0x41414141`41414141
a0 ffffd000`d589b980 41414141`41414141     0x41414141`41414141
a1 ffffd000`d589b988 41414141`41414141     0x41414141`41414141
a2 ffffd000`d589b990 41414141`41414141     0x41414141`41414141
a3 ffffd000`d589b998 41414141`41414141     0x41414141`41414141
a4 ffffd000`d589b9a0 41414141`41414141     0x41414141`41414141
a5 ffffd000`d589b9a8 41414141`41414141     0x41414141`41414141
a6 ffffd000`d589b9b0 41414141`41414141     0x41414141`41414141
a7 ffffd000`d589b9b8 41414141`41414141     0x41414141`41414141
a8 ffffd000`d589b9c0 41414141`41414141     0x41414141`41414141
a9 ffffd000`d589b9c8 41414141`41414141     0x41414141`41414141
aa ffffd000`d589b9d0 41414141`41414141     0x41414141`41414141
ab ffffd000`d589b9d8 41414141`41414141     0x41414141`41414141
ac ffffd000`d589b9e0 41414141`41414141     0x41414141`41414141
ad ffffd000`d589b9e8 41414141`41414141     0x41414141`41414141
ae ffffd000`d589b9f0 41414141`41414141     0x41414141`41414141
af ffffd000`d589b9f8 41414141`41414141     0x41414141`41414141
b0 ffffd000`d589ba00 41414141`41414141     0x41414141`41414141
b1 ffffd000`d589ba08 41414141`41414141     0x41414141`41414141
b2 ffffd000`d589ba10 41414141`41414141     0x41414141`41414141
b3 ffffd000`d589ba18 41414141`41414141     0x41414141`41414141
b4 ffffd000`d589ba20 41414141`41414141     0x41414141`41414141
b5 ffffd000`d589ba28 41414141`41414141     0x41414141`41414141
b6 ffffd000`d589ba30 41414141`41414141     0x41414141`41414141
b7 ffffd000`d589ba38 41414141`41414141     0x41414141`41414141
b8 ffffd000`d589ba40 41414141`41414141     0x41414141`41414141
b9 ffffd000`d589ba48 41414141`41414141     0x41414141`41414141
ba ffffd000`d589ba50 41414141`41414141     0x41414141`41414141
bb ffffd000`d589ba58 41414141`41414141     0x41414141`41414141
bc ffffd000`d589ba60 41414141`41414141     0x41414141`41414141
bd ffffd000`d589ba68 41414141`41414141     0x41414141`41414141
be ffffd000`d589ba70 41414141`41414141     0x41414141`41414141
bf ffffd000`d589ba78 41414141`41414141     0x41414141`41414141
c0 ffffd000`d589ba80 41414141`41414141     0x41414141`41414141
c1 ffffd000`d589ba88 41414141`41414141     0x41414141`41414141
c2 ffffd000`d589ba90 41414141`41414141     0x41414141`41414141
c3 ffffd000`d589ba98 41414141`41414141     0x41414141`41414141
c4 ffffd000`d589baa0 41414141`41414141     0x41414141`41414141
c5 ffffd000`d589baa8 41414141`41414141     0x41414141`41414141
c6 ffffd000`d589bab0 41414141`41414141     0x41414141`41414141
c7 ffffd000`d589bab8 41414141`41414141     0x41414141`41414141
c8 ffffd000`d589bac0 41414141`41414141     0x41414141`41414141
c9 ffffd000`d589bac8 41414141`41414141     0x41414141`41414141
ca ffffd000`d589bad0 41414141`41414141     0x41414141`41414141
cb ffffd000`d589bad8 41414141`41414141     0x41414141`41414141
cc ffffd000`d589bae0 41414141`41414141     0x41414141`41414141
cd ffffd000`d589bae8 41414141`41414141     0x41414141`41414141
ce ffffd000`d589baf0 41414141`41414141     0x41414141`41414141
cf ffffd000`d589baf8 41414141`41414141     0x41414141`41414141
d0 ffffd000`d589bb00 41414141`41414141     0x41414141`41414141
d1 ffffd000`d589bb08 41414141`41414141     0x41414141`41414141
d2 ffffd000`d589bb10 41414141`41414141     0x41414141`41414141
d3 ffffd000`d589bb18 41414141`41414141     0x41414141`41414141
d4 ffffd000`d589bb20 41414141`41414141     0x41414141`41414141
d5 ffffd000`d589bb28 41414141`41414141     0x41414141`41414141
d6 ffffd000`d589bb30 41414141`41414141     0x41414141`41414141
d7 ffffd000`d589bb38 41414141`41414141     0x41414141`41414141
d8 ffffd000`d589bb40 41414141`41414141     0x41414141`41414141
d9 ffffd000`d589bb48 41414141`41414141     0x41414141`41414141
da ffffd000`d589bb50 41414141`41414141     0x41414141`41414141
db ffffd000`d589bb58 41414141`41414141     0x41414141`41414141
dc ffffd000`d589bb60 41414141`41414141     0x41414141`41414141
dd ffffd000`d589bb68 41414141`41414141     0x41414141`41414141
de ffffd000`d589bb70 41414141`41414141     0x41414141`41414141
df ffffd000`d589bb78 41414141`41414141     0x41414141`41414141
e0 ffffd000`d589bb80 41414141`41414141     0x41414141`41414141
e1 ffffd000`d589bb88 41414141`41414141     0x41414141`41414141
e2 ffffd000`d589bb90 41414141`41414141     0x41414141`41414141
e3 ffffd000`d589bb98 41414141`41414141     0x41414141`41414141
e4 ffffd000`d589bba0 41414141`41414141     0x41414141`41414141
e5 ffffd000`d589bba8 41414141`41414141     0x41414141`41414141
e6 ffffd000`d589bbb0 41414141`41414141     0x41414141`41414141
e7 ffffd000`d589bbb8 41414141`41414141     0x41414141`41414141
e8 ffffd000`d589bbc0 41414141`41414141     0x41414141`41414141
e9 ffffd000`d589bbc8 41414141`41414141     0x41414141`41414141
ea ffffd000`d589bbd0 41414141`41414141     0x41414141`41414141
eb ffffd000`d589bbd8 41414141`41414141     0x41414141`41414141
ec ffffd000`d589bbe0 41414141`41414141     0x41414141`41414141
ed ffffd000`d589bbe8 41414141`41414141     0x41414141`41414141
ee ffffd000`d589bbf0 ffffe000`514dd000     0x41414141`41414141
ef ffffd000`d589bbf8 fffff803`898ea794     0xffffe000`514dd000
f0 ffffd000`d589bc00 fffff803`899755c6     nt!PspSystemThreadStartup+0x58
f1 ffffd000`d589bc60 00000000`00000000     nt!KiStartSystemThread+0x16
```
